<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>SVP - Sistema de Vigilancia Preventiva</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet">
    </head>
    <body class="p-3">
        <div class="container">
            <h1 class="mb-3 text-center">Sistema de Vigilancia Preventiva</h1>
            <div class="text-center mb-4">
                <h3>Vista de cámara (simulada)</h3>
                <img src="{{ url_for('video_feed') }}" class="border rounded"
                    width="640" />
            </div>

            <div class="text-center mb-4">
                <button class="btn btn-danger me-2" onclick="activar()">Activar
                    alarma</button>
                <button class="btn btn-success"
                    onclick="desactivar()">Desactivar alarma</button>
                <p id="estado" class="mt-3 text-muted"></p>
            </div>

            <h3>Eventos recientes</h3>
            <ul class="list-group">
                {% for e in events %}
                <li class="list-group-item">
                    <strong>{{ e.event_type }}</strong> — {{
                    e.timestamp.strftime("%Y-%m-%d %H:%M:%S") }}
                    <br><small>{{ e.info }}</small>
                </li>
                {% else %}
                <li class="list-group-item text-muted">No hay eventos aún</li>
                {% endfor %}
            </ul>
        </div>

        <script>
    async function activar() {
      const res = await fetch('/api/alarma/activar', { method: 'POST' });
      const data = await res.json();
      document.getElementById('estado').innerText = 'Alarma: ' + data.estado;
      location.reload();
    }

    async function desactivar() {
      const res = await fetch('/api/alarma/desactivar', { method: 'POST' });
      const data = await res.json();
      document.getElementById('estado').innerText = 'Alarma: ' + data.estado;
      location.reload();
    }
  </script>
    </body>
</html>
